## 3.1 通常监视的区域 - Common Areas to Monitor
许多性能问题可以追溯到程序的特定部分。在设计和实现代码时，您应该监视这些区域以确保它们符合您设置的性能目标。

### 3.1.1 为您的程序的关键任务编码 - Code for Your Program’s Key Tasks
在设计程序时，请考虑用户将遇到的任务或工作流程。在您的实施阶段，请务必监视代码以执行这些任务，并确保其性能不会降至可接受的水平以下。如果是这样，你应该立即采取行动纠正这些问题。

程序执行的关键任务因程序而异。例如，一个文字处理器在文本输入和显示期间可能需要快速，而一个文件实用程序在扫描硬盘上的文件和目录期间需要快速。这由您来决定用户最有可能执行哪些任务。

有关如何识别和修复程序中慢速操作的信息，请参阅 [Code Speed Performance Guidelines]()。

### 3.1.2 绘图代码 - Drawing Code
大多数程序都会进行一些绘图。如果您的程序仅使用标准窗口和控件，那么您可能不需要过多担心绘图性能。但是，如果您执行任何自定义绘图，则需要监视绘图代码并确保其在可接受的水平上执行。尤其是，如果您支持以下任何一项，则应该研究如何优化绘图代码。

* 实时调整大小
* 自定义视图绘制代码，特别是如果视图的某些部分可以更新而不更新整个视图
* 纹理图形
* 完全不透明的视图

有关如何优化绘图性能的信息，请参阅 [ Drawing Performance Guidelines](https://developer.apple.com/library/content/documentation/Performance/Conceptual/Drawing/Articles/DrawingPerformance.html#//apple_ref/doc/uid/10000151i)。

### 2.1.3 启动时间初始化代码 - Launch Time Initialization Code
启动时间是初始化程序数据结构并准备应用程序以接收用户输入的时间。但是，许多程序在启动时间内的工作量比必要的要多得多。在很多情况下，启动时执行的任务可以推迟到应用程序布置其用户界面并开始处理事件之后。这种延期让用户觉得你的应用程序很快，这是一个很好的第一印象。

对于需要在 **OS X 10.3.3** 及更早版本中运行的应用程序，提高启动时间的另一种方法是预先绑定应用程序。预先绑定包括预先计算库地址范围并将这些值存储在应用程序二进制文件中。这一步消除了动态加载器（dyld）在启动时计算这些地址范围的需要。对于 **OS X 10.3.4** 版的 dyld 的改进使得在该版本和更高版本中不需要预先绑定。同样，**iOS** 中不需要预先绑定。

有关如何改善启动时间性能的信息，请参阅[Launch Time Performance Guidelines]()。

### 2.1.4 访问文件代码 - File Access Code
文件系统是一个将信息存入内存和 **CPU** 的瓶颈。在访问文件的时候，可能会执行数千万条指令。因此，您必须检查程序使用文件的方式并确保这些文件实际上是确实需要和合理使用的。

最大限度地减少您使用的文件数量是提高文件相关性能的一种方法。当您访问文件时，请牢记以下几点：

* 了解系统如何缓存文件数据并知道如何优化这些缓存的使用。避免自己缓存数据，除非您打算多次提及它。
* 尽可能地按顺序读取和写入数据。跳过一个文件将要花费额外的时间来寻找新的位置。
* 尽可能从文件中读取更大的数据块，请记住，一次读取太多数据可能会导致不同的问题。例如，读取 32 MB文件的全部内容可能会在操作完成之前触发对这些内容的分页。
* 避免不必要地关闭和重新打开文件。如果启用了缓存，则即使数据未更改，也可能会刷新缓存。

有关如何识别和修复文件相关性能问题的信息，请参阅 [File-System Performance Guidelines]()。

### 2.1.5 应用程序的占用 - Application Footprint
代码的大小可能会对系统性能产生巨大影响。您的程序使用的内存页越多，系统和其他程序可用的内存就越少。这种内存压力最终会导致分页和整个系统的减速。

管理你的代码占用就是组织你的代码和数据结构。您需要确保内存中有正确的部分，并且不会导致任何内存页面被不必要地读取或写入。导致大量内存占用的一些问题如下所示：

* 代码页包含未使用的代码。编译器通常通过编译模块来组织代码，这并不总是最好的技术。根据代码一起执行来组织模块可能是更好的选择。
* 静态或常量数据存储在可写页面上。在分页过程中，这些数据不必要地写入磁盘。尽你所能将这些数据移动到可以快速清除的不可写入页面。
* 程序导出的符号（symbols）比实际需要的要多。符号占用空间，只有在外部代码模块调用你的程序时才需要。删除不应该在外部使用的符号。
* 代码没有被编译器和链接器正确优化。一定要尝试编译器的优化设置，并查看哪一个最适合您的程序。
* 该程序包含了太多的框架。只加载程序实际使用的框架。

有关如何查找和修复代码占位面积问题的信息，请参阅 [Code Size Performance Guidelines]()。

### 2.1.6 内存分配代码 - Memory Allocation Code
程序为存储永久和临时数据结构都分配内存。无论是在 CPU 时间还是在内存消耗中，每个内存分配都会产生与其相关的成本。了解您的程序何时分配内存以及如何使用该内存可以帮助您降低这两项成本。

了解程序的内存使用情况可以帮助确定减少内存使用量的方法。您可以使用可用的性能工具来确定自动释放（autoreleased）的 **Objective-C** 对象在导致过多分页之前是否被释放。您还可以使用这些工具来查找代码中的 **bug** 引起的内存泄漏。看着你调用 `malloc` 的次数也可能指出你可以重用现有内存块而不是创建新内存块的地方。

分配内存时遵循的一条重要规则是懒惰。推迟内存分配，直到您确实需要使用的内存。对于一些其他的方式，你可以懒惰的内存分配，请参阅[Be Lazy](https://developer.apple.com/library/content/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html#//apple_ref/doc/uid/TP40001410-CH204-BCIHHDAA)。

有关优化内存分配模式的信息，请参阅 [Memory Usage Performance Guidelines](https://developer.apple.com/library/content/documentation/Performance/Conceptual/ManagingMemory/ManagingMemory.html#//apple_ref/doc/uid/10000160i)。