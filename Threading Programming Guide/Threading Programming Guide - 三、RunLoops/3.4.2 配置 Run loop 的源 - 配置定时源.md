### 3.4.2 配置 Run loop 的源 - 配置定时源

创建一个定时源，你所需要做的只是创建一个定时器对象并把它调度到你的 **run loop**。**Cocoa** 程序中使用 **NSTimer** 类来创建一个新的定时器对象，而 **Core Foundation** 中使用 **CFRunLoopTimerRef** 不透明类型。本质上，**NSTimer** 类是 **Core Foundation** 的简单扩展，它提供了便利的特征，例如能使用相同的方法创建和调配定时器。

**Cocoa** 中可以使用以下 **NSTimer** 类方法来创建并调配一个定时器：
* scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:
* scheduledTimerWithTimeInterval:invocation:repeats:

上述方法创建了定时器并以默认模式把它们添加到当前线程的 **run loop**。你可以手动创建 **NSTimer** 对象，并通过 **NSRunLoop** 的 `addTimer:forMode:` 把它添加到 **run loop**。两种方法都做了相同的事，区别在于你对定时器配置的控制权。例如，如果你手工创建定时器并把它添加到 **run loop**，你可以选择要添加的模式而不使用默认模式。

Listing 3-10 显示了如何使用这这两种方法创建定时器。第一个定时器在初始化后 **1** 秒开始运行，此后每隔 **0.1** 秒运行。第二个定时器则在初始化后 **0.2** 秒开始运行，此后每隔 **0.2** 秒运行。

<p align = center>Listing 3-10 Creating and scheduling timers using NSTimer

``` Objective-C
NSRunLoop* myRunLoop = [NSRunLoop currentRunLoop];

// Create and schedule the first timer.
NSDate* futureDate = [NSDate dateWithTimeIntervalSinceNow:1.0];
NSTimer* myTimer = [[NSTimer alloc] initWithFireDate:futureDate
                                            interval:0.1
                                              target:self
                                            selector:@selector(myDoFireTimer1:)
                                            userInfo:nil
                                             repeats:YES];
[myRunLoop addTimer:myTimer forMode:NSDefaultRunLoopMode];

// Create and schedule the second timer.
[NSTimer scheduledTimerWithTimeInterval:0.2
                                 target:self
                               selector:@selector(myDoFireTimer2:)
                               userInfo:nil
                                repeats:YES];
```


Listing 3-11 显示了使用 **Core Foundation** 函数来配置定时器的代码。尽管这个例子中并没有把任何用户定义的信息作为上下文结构，但是你可以使用这个上下文结构传递任何你想传递的信息给定时器。关于该上下文结构的内容的详细信息，参阅 [CFRunLoopTimer Reference](https://developer.apple.com/documentation/corefoundation/cfrunlooptimer-rhk)。

<p align = center>Listing 3-11 Creating and scheduling a timer using Core Foundation</p>

``` Objective-C
CFRunLoopRef runLoop = CFRunLoopGetCurrent();
CFRunLoopTimerContext context = {0, NULL, NULL, NULL, NULL};
CFRunLoopTimerRef timer = CFRunLoopTimerCreate(kCFAllocatorDefault, 0.1, 0.3, 0, 0,&myCFTimerCallback, &context);
CFRunLoopAddTimer(runLoop, timer, kCFRunLoopCommonModes);
```