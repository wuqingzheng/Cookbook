## 4.3 线程安全和信号量

当涉及到线程应用程序时，没有什么比处理信号更令人恐惧和困惑的了。信号是一种底层的 **BSD** 机制，可用于向进程传递信息或以某种方式操作它。一些程序使用信号来检测特定事件，比如子进程的消亡。系统使用信号来终止失控进程并传达其他类型的信息。

使用信号的问题不在于他们做什么，而是在于当程序是多线程的时候它们的行为。在单线程应用程序中，所有信号处理程序都在主线程上运行。在多线程应用程序中，那些与特定硬件错误无关的信号（例如非法指令）将会传送到当时正在运行的任何线程。如果多个线程同时运行，则信号被传送到系统随机挑选的任何一个线程。换句话说，信号可以传送到应用程序的任何线程。

在应用程序中实现信号处理程序的第一条规则是避免假设哪个线程正在处理信号。如果某个特定的线程想要处理给定的信号，则需要在信号到达时通过某种方式通知该线程。而不是仅仅假设从该线程安装信号处理程序将导致信号被传递到同一个线程。

有关信号和安装信号处理程序的更多信息，请参阅 **signal** 和 **sigaction** 手册页。
