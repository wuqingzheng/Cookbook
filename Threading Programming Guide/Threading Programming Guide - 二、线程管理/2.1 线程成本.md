## 2.1 线程成本

多线程会占用你应用程序(和系统的)的内存和性能方面的资源。每个线程都需要分配一定的内核内存（kernel memory space ）和应用程序内存空间的内存（program’s memory space）。管理你的线程和协调其调度所需的核心数据结构存储在使用 Wired Memory 的内核里面。你线程的堆栈空间和每个线程的数据都被存储在你应用程序的内存空间里面。这些数据结构里面的大部分都是当你首次创建线程或者进程的时候被创建和初始化的，因为需要和内核交互，所以它们所需的代价成本很高。

表 2-1 量化了在你应用程序创建一个新的用户级线程所需的大致成本。这些成本里面的部分是可配置的，比如为辅助线程分配堆栈空间的大小。创建一个线程所需的时间成本是粗略估计的，仅用于当互相比较的时候。线程创建时间很大程度依赖于处理器的负载，计算速度，和可用的系统和程序空间。

Table 2-1 Thread creation costs
   
Item | Approximate cost | Notes 
- | :-: | :-: | -:
Kernel data structures | Approximately 1KB|This memory is used to store the thread data structures and attributes,much of which is allocated as wired memory and therefore cannot be paged to disk.
Stack space| 512 KB(secondary threads) 8 MB (Mac OS X main thread) 1 MB (iOS main thread) | The minimum allowed stack size for secondary threads is 16 KB and the stack size must be a multiple of 4 KB. The space for this memory is set aside in your process space at thread creation time, but the actual pages associated with that memory are not created until they are needed.
Creation time| Approximately 90 microseconds | This value reflects the time between the initial call to create the thread and the time at which the thread’s entry point routine began executing. The figures were determined by analyzing the mean and median values generated during thread creation on an Intel-based iMac with a 2 GHz Core Duo processor and 1 GB of RAM running Mac OS X v10.5.


当编写线程代码时另外一个需要考虑的成本是生产成本。设计一个线程应用程序有时会需要根本性改变你应用程序数据结构的组织方式。要做这些改变可能需要避免使用同步，因为本身设计不好的应用可能会造成巨大的性能损失。设计这些数据结构和在线程代码里面调试问题会增加开发一个线程应用所需的时间。然而避免这些消耗的话，可能在运行时候带来更大的问题，如果你的多线程花费太多的时间在锁的等待而没有做任何事情。