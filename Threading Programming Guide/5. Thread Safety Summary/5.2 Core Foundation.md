## 5.2 Core Foundation

**Core Foundation** 是足够线程安全的，如果你的程序注意一下的话，应该不会遇到任何线程竞争的问题。通常情况下是线程安全的，比如当你查询（**query**）、引用(**retain**)、释放(**release**)和传递(**pass**)不可变对象时。甚至在多个线程查询中央共享对象也是线程安全的。

像 **Cocoa** 那样，当涉及对象或它们内容突变时，**Core Foundation** 是非线程安全的。比如，正如你所期望的，无论修改一个可变数据或可变数组对象，还是修改一个可变数组里面的对象都是非线程安全的。其中一个原因是性能，这在这些情况下至关重要。此外，在该级别上实现完全线程安全是几乎不可能的。例如，你不能排除引用（**retain**）从集合中获取的对象所导致的不确定行为。在调用引用（**retain**）包含的对象之前，集合本身可能已经被释放。

这些情况下，当你的对象被多个线程访问或修改，你的代码应该在相应的地方使用锁来保护它们不要被同时访问。例如，枚举 **Core Foundation** 数组对象的代码，在该枚举块代码周围应该使用合适的锁来保护它免遭其他线程修改。