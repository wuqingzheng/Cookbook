
## 2 关于虚拟内存系统 - About the Virtual Memory System 
高效的内存管理是在 **OS X** 和 **iOS** 中编写高性能代码的重要方面。最大限度地减少内存使用量不仅可以减少应用程序的内存占用量，还可以减少消耗的 **CPU** 时间。为了正确调整代码，您需要了解底层系统如何管理内存。

**OS X** 和 **iOS** 均包含一个完全集成的虚拟内存系统，它总是存在，您无法关闭。两个系统都为每个 32 位进程提供高达 4GB 字节的可寻址空间。另外，**OS X** 为 64 位进程提供大约 18EB 字节的可寻址空间。即使对于有 4GB 或更多可用 RAM 的计算机，系统也很少将这么多 RAM 用于单个进程。

为了让进程访问整个 4GB 字节或 18EB 字节地址空间，**OS X** 使用硬盘来保存当前未使用的数据。当内存变满时，未使用的内存部分被写入磁盘，来为现在需要的数据腾出空间。存储未使用数据的磁盘部分称为后备存储（backing store），因为它为主存提供备份存储。

虽然 **OS X** 支持后备存储，但 **iOS** 不支持。 在 iPhone 应用程序中，已经在磁盘上的只读数据（例如代码页）只是从内存中删除并根据需要从磁盘重新加载。操作系统永远不会将可写数据从内存中删除。相反，如果可用内存的数量下降到某个阈值以下，系统会要求正在运行的应用程序自动释放内存来为新数据腾出空间。未能释放足够内存的应用程序将被终止。

> 注意：与大多数基于 **UNIX** 的操作系统不同，**OS X** 不使用预分配的磁盘分区作为后备存储。而是使用机器启动分区上的所有可用空间。

以下各节介绍相关术语并提供 **OS X** 和 **iOS** 中使用的虚拟内存系统的简要概述。有关虚拟内存系统如何工作的更多详细信息，请参阅 [Kernel Programming Guide](https://developer.apple.com/library/content/documentation/Darwin/Conceptual/KernelProgramming/About/About.html#//apple_ref/doc/uid/TP30000905)。
